{% extends "base.html" %}

{% block title %}Settings - DMX Lighting Control{% endblock %}

{% block content %}
<div class="row">
    <div class="col-md-6">
        <div class="settings-section">
            <h5><i class="bi bi-hdd"></i> Storage Management</h5>
            
            <div class="storage-info">
                <div class="storage-icon">
                    <i class="bi bi-device-hdd"></i>
                </div>
                <div class="storage-details">
                    <h6>Internal Storage</h6>
                    <div class="progress-bar-container">
                        <div class="progress">
                            <div class="progress-bar progress-bar-initial" id="internalStorageBar"></div>
                        </div>
                    </div>
                    <small id="internalStorageText">Loading...</small>
                </div>
            </div>
            
            <div class="mt-3">
                <h6>External Storage Devices</h6>
                <div id="externalStorageList">
                    <!-- External storage devices will be loaded here -->
                </div>
                
                <div class="mt-3">
                    <button class="btn btn-outline-primary" onclick="scanExternalStorage()">
                        <i class="bi bi-arrow-clockwise"></i> Scan for Devices
                    </button>
                    <button class="btn btn-outline-secondary" onclick="addExternalStorage()">
                        <i class="bi bi-plus"></i> Add Storage
                    </button>
                </div>
            </div>
            
            <div class="mt-4">
                <h6>Storage Settings</h6>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="autoCopyExternal" checked>
                    <label class="form-check-label" for="autoCopyExternal">
                        Automatically copy uploaded files to internal storage
                    </label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="cleanupOldFiles">
                    <label class="form-check-label" for="cleanupOldFiles">
                        Automatically delete old files when storage is low
                    </label>
                </div>
            </div>
        </div>
        
        <div class="settings-section">
            <h5><i class="bi bi-shield"></i> Security Settings</h5>
            
            <div class="mb-3">
                <label for="webPassword" class="form-label">Web Interface Password</label>
                <div class="input-group">
                    <input type="password" class="form-control" id="webPassword" placeholder="Enter new password">
                    <button class="btn btn-outline-secondary" type="button" onclick="togglePasswordVisibility()" title="Show or hide password">
                        <i class="bi bi-eye" id="passwordToggleIcon"></i>
                    </button>
                </div>
                <small class="form-text text-muted">
                    Leave empty to disable password protection
                </small>
            </div>
            
            <div class="mb-3">
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="enableHttps">
                    <label class="form-check-label" for="enableHttps">
                        Enable HTTPS (requires SSL certificate)
                    </label>
                </div>
            </div>
            
            <button class="btn btn-primary" onclick="saveSecuritySettings()">
                <i class="bi bi-save"></i> Save Security Settings
            </button>
        </div>
    </div>
    
    <div class="col-md-6">
        <div class="settings-section">
            <h5><i class="bi bi-wifi"></i> Network Settings</h5>
            
            <div class="mb-3">
                <div class="btn-group w-100" role="group">
                    <input type="radio" class="btn-check" name="networkMode" id="wifiMode" value="wifi" checked>
                    <label class="btn btn-outline-primary" for="wifiMode">WiFi Client</label>
                    
                    <input type="radio" class="btn-check" name="networkMode" id="hotspotMode" value="hotspot">
                    <label class="btn btn-outline-primary" for="hotspotMode">Hotspot</label>
                </div>
            </div>
            
            <!-- WiFi Client Settings -->
            <div id="wifiSettings">
                <h6>WiFi Networks</h6>
                <div class="d-flex justify-content-between mb-2">
                    <span>Available Networks:</span>
                    <button class="btn btn-sm btn-outline-secondary" onclick="scanWiFi()">
                        <i class="bi bi-arrow-clockwise"></i> Rescan
                    </button>
                </div>
                
                <div id="wifiNetworks" class="wifi-networks-container">
                    <!-- WiFi networks will be loaded here -->
                </div>
                
                <div class="mt-3">
                    <button class="btn btn-outline-primary" onclick="addCustomWiFi()">
                        <i class="bi bi-plus"></i> Add Custom Network
                    </button>
                </div>
            </div>
            
            <!-- Hotspot Settings -->
            <div id="hotspotSettings" class="hidden">
                <h6>Hotspot Configuration</h6>
                <div class="mb-3">
                    <label for="hotspotSSID" class="form-label">Network Name (SSID)</label>
                    <input type="text" class="form-control" id="hotspotSSID" value="DMX-Control-AP">
                </div>
                <div class="mb-3">
                    <label for="hotspotPassword" class="form-label">Password</label>
                    <input type="password" class="form-control" id="hotspotPassword" placeholder="Enter hotspot password">
                    <small class="form-text text-muted">
                        Leave empty for open network (not recommended)
                    </small>
                </div>
                <div class="mb-3">
                    <label for="hotspotChannel" class="form-label">WiFi Channel</label>
                    <select class="form-select" id="hotspotChannel">
                        <option value="1">1 (2.412 GHz)</option>
                        <option value="6" selected>6 (2.437 GHz)</option>
                        <option value="11">11 (2.462 GHz)</option>
                    </select>
                </div>
            </div>
            
            <div class="mt-3">
                <div class="d-flex justify-content-between align-items-center">
                    <span>Current Status:</span>
                    <span id="networkStatus" class="badge bg-secondary">Checking...</span>
                </div>
                <div class="mt-2">
                    <small id="networkDetails" class="text-muted">Loading network information...</small>
                </div>
            </div>
            
            <div class="mt-3">
                <button class="btn btn-primary" onclick="saveNetworkSettings()">
                    <i class="bi bi-save"></i> Apply Network Settings
                </button>
                <button class="btn btn-outline-warning" onclick="restartNetwork()">
                    <i class="bi bi-arrow-clockwise"></i> Restart Network
                </button>
            </div>
        </div>
        
        <div class="settings-section">
            <h5><i class="bi bi-gear"></i> System Settings</h5>
            
            <div class="mb-3">
                <label for="systemName" class="form-label">System Name</label>
                <input type="text" class="form-control" id="systemName" value="DMX Control System">
            </div>
            
            <div class="mb-3">
                <label for="timezone" class="form-label">Timezone</label>
                <select class="form-select" id="timezone">
                    <option value="UTC">UTC</option>
                    <option value="US/Eastern">US/Eastern</option>
                    <option value="US/Central">US/Central</option>
                    <option value="US/Mountain">US/Mountain</option>
                    <option value="US/Pacific">US/Pacific</option>
                    <option value="Europe/London">Europe/London</option>
                    <option value="Europe/Berlin">Europe/Berlin</option>
                    <option value="Asia/Tokyo">Asia/Tokyo</option>
                </select>
            </div>
            
            <div class="mb-3">
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="autoStart" checked>
                    <label class="form-check-label" for="autoStart">
                        Start DMX control on system boot
                    </label>
                </div>
            </div>
            
            <div class="mb-3">
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="enableLogging" checked>
                    <label class="form-check-label" for="enableLogging">
                        Enable system logging
                    </label>
                </div>
            </div>
            
            <div class="mb-3">
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="darkMode">
                    <label class="form-check-label" for="darkMode">
                        Enable dark mode
                    </label>
                </div>
            </div>
            
            <button class="btn btn-primary" onclick="saveSystemSettings()">
                <i class="bi bi-save"></i> Save System Settings
            </button>
            
            <div class="mt-4">
                <h6>System Actions</h6>
                <div class="d-grid gap-2">
                    <button class="btn btn-outline-info" onclick="exportAllSettings()">
                        <i class="bi bi-download"></i> Export All Settings
                    </button>
                    <button class="btn btn-outline-secondary" onclick="importSettings()">
                        <i class="bi bi-upload"></i> Import Settings
                    </button>
                    <button class="btn btn-outline-warning" onclick="restartSystem()">
                        <i class="bi bi-arrow-clockwise"></i> Restart System
                    </button>
                    <button class="btn btn-outline-danger" onclick="factoryReset()">
                        <i class="bi bi-arrow-counterclockwise"></i> Factory Reset
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- WiFi Password Modal -->
<div class="modal fade" id="wifiPasswordModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Connect to WiFi</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>Enter password for network: <strong id="selectedSSID"></strong></p>
                <div class="mb-3">
                    <label for="wifiPasswordInput" class="form-label">Password</label>
                    <input type="password" class="form-control" id="wifiPasswordInput">
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="connectToWiFi()">Connect</button>
            </div>
        </div>
    </div>
</div>

<!-- Custom WiFi Modal -->
<div class="modal fade" id="customWifiModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Add Custom WiFi Network</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" title="Close"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <label for="customSSID" class="form-label">Network Name (SSID)</label>
                    <input type="text" class="form-control" id="customSSID">
                </div>
                <div class="mb-3">
                    <label for="customPassword" class="form-label">Password</label>
                    <input type="password" class="form-control" id="customPassword">
                </div>
                <div class="mb-3">
                    <label for="customSecurity" class="form-label">Security</label>
                    <select class="form-select" id="customSecurity">
                        <option value="WPA2">WPA2</option>
                        <option value="WPA">WPA</option>
                        <option value="WEP">WEP</option>
                        <option value="OPEN">Open (No Security)</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="addCustomNetwork()">Add Network</button>
            </div>
        </div>
    </div>
</div>

<!-- Import Settings Modal -->
<div class="modal fade" id="importSettingsModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Import Settings</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" title="Close"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <label for="settingsFile" class="form-label">Select Settings File (JSON)</label>
                    <input type="file" class="form-control" id="settingsFile" accept=".json">
                </div>
                <div class="alert alert-warning">
                    <i class="bi bi-exclamation-triangle"></i>
                    Importing settings will overwrite current configuration. Make sure to export current settings first.
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="performSettingsImport()">Import</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/settings/settings.js') }}"></script>
{% endblock %}