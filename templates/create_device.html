{% extends "base.html" %}

{% block title %}Create Device - DMX Lighting Control{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-8">
        <div class="card">
            <div class="card-header">
                <h5><i class="bi bi-plus-circle"></i> Create/Edit Device</h5>
            </div>
            <div class="card-body">
                <form id="deviceForm" action="/api/save-device" method="POST">
                    <input type="hidden" id="deviceId" name="device_id">
                    
                    <div class="mb-3">
                        <label for="deviceName" class="form-label">Device Name</label>
                        <input type="text" class="form-control" id="deviceName" name="name" required 
                               placeholder="e.g., RGB Par Can, Moving Head, etc.">
                    </div>
                    
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label class="form-label">Shape</label>
                            <input type="hidden" id="deviceShape" name="shape" value="circle">
                            <div class="shape-selector">
                                <button type="button" class="shape-btn active" data-shape="circle" onclick="selectShape('circle')">
                                    <div class="shape-preview circle"></div>
                                    <span>Circle</span>
                                </button>
                                <button type="button" class="shape-btn" data-shape="square" onclick="selectShape('square')">
                                    <div class="shape-preview square"></div>
                                    <span>Square</span>
                                </button>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <label for="deviceColor" class="form-label">Outline Color</label>
                            <input type="color" class="form-control form-control-color" id="deviceColor" 
                                   name="color" value="#ffffff" onchange="updatePreview()">
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">Channel Configuration</label>
                        <div class="channel-config" id="channelConfig">
                            <div class="d-flex justify-content-between align-items-center mb-3">
                                <h6>Channels</h6>
                                <button type="button" class="btn btn-sm btn-outline-primary" onclick="addChannel()">
                                    <i class="bi bi-plus"></i> Add Channel
                                </button>
                            </div>
                            
                            <div id="channelList">
                                <!-- Channels will be added here dynamically -->
                            </div>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <div class="card bg-light">
                            <div class="card-body">
                                <h6><i class="bi bi-lightbulb"></i> Channel Types</h6>
                                <div class="row">
                                    <div class="col-md-4">
                                        <ul class="list-unstyled">
                                            <li><span class="badge badge-dimmer">Dimmer</span> Master brightness control</li>
                                            <li><span class="badge badge-dimmer-fine">Dimmer_fine</span> Fine dimmer control</li>
                                            <li><span class="badge badge-red">Red</span> Red color channel</li>
                                            <li><span class="badge badge-green">Green</span> Green color channel</li>
                                            <li><span class="badge badge-blue">Blue</span> Blue color channel</li>
                                            <li><span class="badge badge-white">White</span> White color channel</li>
                                        </ul>
                                    </div>
                                    <div class="col-md-4">
                                        <ul class="list-unstyled">
                                            <li><span class="badge badge-pan">Pan</span> Horizontal movement</li>
                                            <li><span class="badge badge-pan-fine">Pan_fine</span> Fine pan control</li>
                                            <li><span class="badge badge-tilt">Tilt</span> Vertical movement</li>
                                            <li><span class="badge badge-tilt-fine">Tilt_fine</span> Fine tilt control</li>
                                            <li><span class="badge badge-gobo1">Gobo1</span> Gobo wheel 1</li>
                                            <li><span class="badge badge-gobo2">Gobo2</span> Gobo wheel 2</li>
                                            <li><span class="badge badge-gobo-rotation">Gobo_rotation</span> Gobo rotation</li>
                                            <li><span class="badge badge-gobo-rotation-fine">Gobo_rotation_fine</span> Fine gobo rotation</li>
                                        </ul>
                                    </div>
                                    <div class="col-md-4">
                                        <ul class="list-unstyled">
                                            <li><span class="badge badge-color-wheel">Color_Wheel</span> Color wheel</li>
                                            <li><span class="badge badge-strobe">Strobe</span> Strobe/shutter</li>
                                            <li><span class="badge badge-prism">Prism</span> Prism effect</li>
                                            <li><span class="badge badge-prisma-rotation">Prisma_rotation</span> Prism rotation</li>
                                            <li><span class="badge badge-frost">Frost</span> Frost/diffusion</li>
                                            <li><span class="badge badge-zoom">Zoom</span> Beam</li>
                                            <li><span class="badge badge-zoom-fine">Zoom_fine</span> Fine zoom control</li>
                                            <li><span class="badge badge-focus">Focus</span> Beam focus</li>
                                            <li><span class="badge badge-focus-fine">Focus_fine</span> Fine focus control</li>
                                            <li><span class="badge badge-macro">Macro</span> Preset macros</li>
                                            <li><span class="badge badge-special-functions">Special_functions</span> Special functions</li>
                                            <li><span class="badge badge-reset">Reset</span> Function reset</li>
                                            <li><span class="badge badge-dummy">Dummy</span> Unused/reserved</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="d-flex justify-content-between">
                        <a href="{{ url_for('patch') }}" class="btn btn-secondary">
                            <i class="bi bi-arrow-left"></i> Back to Patch
                        </a>
                        <div>
                            {% if request.args.get('edit') %}
                            <button type="button" class="btn btn-danger me-2" onclick="deleteDevice()">
                                <i class="bi bi-trash"></i> Delete
                            </button>
                            {% endif %}
                            <button type="submit" class="btn btn-primary">
                                <i class="bi bi-save"></i> Save Device
                            </button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <div class="col-md-4">
        <div class="card">
            <div class="card-header">
                <h5><i class="bi bi-eye"></i> Device Preview</h5>
            </div>
            <div class="card-body">
                <div class="text-center mb-3">
                    <div class="device-preview" id="devicePreview">
                        <div class="preview-fixture" id="previewFixture">
                            <span id="previewName">Device</span>
                        </div>
                    </div>
                </div>
                
                <div class="preview-info">
                    <h6>Channel Summary</h6>
                    <div id="channelSummary">
                        <small class="text-muted">Add channels to see summary</small>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="card mt-3">
            <div class="card-header">
                <h5><i class="bi bi-collection"></i> Device Templates</h5>
            </div>
            <div class="card-body">
                <div class="d-grid gap-2">
                    <button class="btn btn-outline-secondary btn-sm" onclick="loadTemplate('rgb_par')">
                        RGB Par Can
                    </button>
                    <button class="btn btn-outline-secondary btn-sm" onclick="loadTemplate('rgbw_par')">
                        RGBW Par Can
                    </button>
                    <button class="btn btn-outline-secondary btn-sm" onclick="loadTemplate('moving_head')">
                        Moving Head
                    </button>
                    <button class="btn btn-outline-secondary btn-sm" onclick="loadTemplate('dimmer')">
                        Simple Dimmer
                    </button>
                    <button class="btn btn-outline-secondary btn-sm" onclick="loadTemplate('strobe')">
                        Strobe Light
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/create_device/create_device.js') }}"></script>
{% endblock %}